**문제점 및 해결방안**
HM-10 블루투스 4.0 모듈 2개를 각 마스터, 슬레이브로 role을 할당해 서로 쌍방향 통신을 하려고 함.
인터넷의 정보에는 role 설정 후 AT 커맨드 중 AT+CONN(Mac Address) 를 입력하면 된다고 하지만
현재 가지고 있는 608V 펌웨어에서는 해당 방법으로 연결이 불가.

데이터시트를 찾아서 해결하였음.

![[Pasted image 20250711163207.png]]
데이터시트에서 발췌.

608v 펌웨어에서는 VERR 커맨드만 작동, 006v 펌웨어에서는 VERS 커맨드만 작동함.
펌웨어 버전이 다를 시 서로 연동 불가.
608버전 모듈만 사용했음.

![[Pasted image 20250711163340.png]]
데이터시트에서 발췌.

위 커맨드를 사용해 AT+ROLE1(master) / AT+ROLE0 으로 각 모듈에 마스터 / 슬레이브 역할을 할당해 줌.

![[Pasted image 20250711163523.png]]
위 커맨드는 처음 전원 인가 시 바로 페어링 대상을 찾을지, 아니면 AT커맨드를 받을 지 설정하는 커맨드.
slave는 0으로 설정하여 마스터가 연결을 시도하면 바로 받을 수 있게 해야 함
master는 1로 설정하여 slave의 맥 주소만을 이용해 연결하도록 해야 함.


![[Pasted image 20250711163953.png]]
위의 커맨드로 슬레이브의 맥 주소를 받아야 함.
위 커맨드의 응답으로 받은 주소를 복사 후 나중에 마스터와 슬레이브를 연결할 때 사용.


![[Pasted image 20250711163750.png]]
![[Pasted image 20250711163806.png]]
AT+CONN 명령어가 아닌 위의 명령어를 사용해야 함.

슬레이브의 맥 주소를 알고, 해당 슬레이브와만 연결할 것이기 때문에 P0 파라미터는 0으로 설정.
AT+CO0(슬레이브 맥 주소) 커맨드로 슬레이브와 연결해야 함.


![[Pasted image 20250711164114.png]]
AT+CO 명령어로 연결에 성공했다면 이후에는 위의 명령어를 사용해서 간단하게 연결 가능.
마지막으로 성공적으로 연결했던 기기와 자동으로 연결하는 커맨드.


CUBEIDE에서 CONNL 명령어로 연결을 하려면
```c
char atcon[] = "AT+CONNL";

  HAL_Delay(1000);
  HAL_UART_Transmit(&huart2, (uint8_t *)atcon, strlen(atcon), HAL_MAX_DELAY);
  HAL_Delay(1000);
```

과 같이 연결해야 함.
uint8_t 타입이 아닌 char 타입을 사용하는 이유와 sizeof이 아닌 strlen을 사용하는 이유는
uint 타입 어레이로 문자열을 생성하면 문자열이 끝남을 알리는 널 문자(\0)가 자동으로 들어가는데,
![[Pasted image 20250711164544.png]]
HM-10 모듈의 데이터시트에서 명시된 것 처럼 커맨드 끝에 어떠한 심볼도 들어가면 안됨.
심볼이 들어가는 순간 AT커맨드로 인식을 못함.

그렇기 때문에 char 타입을 strlen 사이즈로 정확히 해당 char 어레이의 길이만큼만 보내주는 것.